<div class="container-fluid p-3" style="max-width: 1400px">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h4 class="fw-bold text-brand mb-0">Dashboard</h4>
      <p class="text-muted small mb-0">
        Visão geral do dia {{ currentDate | date : "dd/MM" }}
      </p>
    </div>
  </div>

  <ng-container *ngIf="stats$ | async as stats; else loading">
    <div class="row g-3 mb-3">
      <div class="col-12 col-md-4">
        <div class="card border-0 shadow-sm h-100 overflow-hidden card-hover">
          <div class="card-body p-3 position-relative">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="text-uppercase text-muted fw-bold small">Receita</div>
              <div
                class="icon-box-sm bg-primary-subtle text-primary rounded-circle"
              >
                <i class="bi bi-graph-up-arrow"></i>
              </div>
            </div>
            <h3 class="text-dark fw-bold mb-0">
              {{ stats.revenue | currency : "BRL" }}
            </h3>
            <div class="bg-shape bg-primary"></div>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="card border-0 shadow-sm h-100 overflow-hidden card-hover">
          <div class="card-body p-3 position-relative">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="text-uppercase text-muted fw-bold small">Custos</div>
              <div
                class="icon-box-sm bg-danger-subtle text-danger rounded-circle"
              >
                <i class="bi bi-people-fill"></i>
              </div>
            </div>
            <h3 class="text-danger fw-bold mb-0">
              {{ stats.cost | currency : "BRL" }}
            </h3>
            <div class="bg-shape bg-danger"></div>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div
          class="card border-0 shadow h-100 overflow-hidden card-hover bg-brand text-white position-relative"
        >
          <div class="card-body p-3 position-relative z-1">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="text-uppercase text-white-50 fw-bold small">
                Lucro Real
              </div>
              <div
                class="icon-box-sm bg-white text-brand rounded-circle shadow-sm"
              >
                <i class="bi bi-wallet2"></i>
              </div>
            </div>
            <h3 class="text-white fw-bold mb-0">
              {{ stats.netProfit | currency : "BRL" }}
            </h3>
            <small class="text-white-50"
              >Margem: {{ stats.margin | number : "1.0-1" }}%</small
            >
          </div>
          <div class="card-pattern"></div>
        </div>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-12 col-lg-8">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body p-3">
            <h6 class="fw-bold text-brand mb-3">Acesso Rápido</h6>
            <div class="row g-2">
              <div class="col-4">
                <a
                  routerLink="/orders/create"
                  class="btn btn-outline-light w-100 p-2 text-center border d-flex flex-column align-items-center gap-1 card-action"
                >
                  <i class="bi bi-plus-lg fs-5 text-brand"></i>
                  <span class="fw-bold text-dark small">Nova Ordem</span>
                </a>
              </div>
              <div class="col-4">
                <a
                  routerLink="/orders"
                  class="btn btn-outline-light w-100 p-2 text-center border d-flex flex-column align-items-center gap-1 card-action"
                >
                  <i class="bi bi-list-ul fs-5 text-primary"></i>
                  <span class="fw-bold text-dark small">Ordens</span>
                </a>
              </div>
              <div class="col-4">
                <a
                  routerLink="/clients"
                  class="btn btn-outline-light w-100 p-2 text-center border d-flex flex-column align-items-center gap-1 card-action"
                >
                  <i class="bi bi-people fs-5 text-info"></i>
                  <span class="fw-bold text-dark small">Clientes</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body p-3">
            <h6 class="fw-bold text-dark mb-3">Status</h6>
            <div class="d-flex flex-column gap-2">
              <div
                class="d-flex justify-content-between align-items-center p-2 rounded"
                [class.bg-danger-subtle]="stats.overdueItemsCount > 0"
                style="border: 1px solid #eee"
              >
                <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                  <span class="small fw-bold">Atrasados</span>
                </div>
                <span
                  class="badge rounded-pill"
                  [ngClass]="
                    stats.overdueItemsCount > 0 ? 'bg-danger' : 'bg-secondary'
                  "
                >
                  {{ stats.overdueItemsCount }}
                </span>
              </div>

              <div
                class="d-flex justify-content-between align-items-center p-2 rounded"
                style="border: 1px solid #eee"
              >
                <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-hourglass-split text-primary"></i>
                  <span class="small fw-bold">Em Andamento</span>
                </div>
                <span class="badge bg-primary rounded-pill">{{
                  stats.activeOrdersCount
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #loading>
    <div class="d-flex justify-content-center py-5">
      <div
        class="spinner-border text-brand spinner-border-sm"
        role="status"
      ></div>
    </div>
  </ng-template>
</div>
