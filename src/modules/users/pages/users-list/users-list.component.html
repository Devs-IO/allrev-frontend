<div class="container my-4">
  <h1 class="mb-4 text-primary">Usuários</h1>
  <!-- Botão de novo usuário removido, agora disponível apenas no menu lateral -->

  <!-- Formulário de criação/edição -->
  <div *ngIf="showForm" class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">{{ isEditMode ? 'Editar Usuário' : 'Novo Usuário' }}</h5>
      <form (ngSubmit)="submitForm()">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label>Nome</label>
            <input class="form-control" [(ngModel)]="formData.name" name="name" required />
          </div>
          <div class="col-md-6 mb-3">
            <label>Email</label>
            <input class="form-control" [(ngModel)]="formData.email" name="email" required />
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label>Telefone</label>
            <input class="form-control" [(ngModel)]="formData.phone" name="phone" />
          </div>
          <div class="col-md-6 mb-3">
            <label>Função</label>
            <input class="form-control" [(ngModel)]="formData.role" name="role" />
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label>Status</label>
            <select class="form-control" [(ngModel)]="formData.isActive" name="isActive">
              <option [ngValue]="true">Ativo</option>
              <option [ngValue]="false">Inativo</option>
            </select>
          </div>
        </div>
        <button type="submit" class="btn btn-primary me-2">Salvar</button>
        <button type="button" class="btn btn-secondary" (click)="cancelForm()">Cancelar</button>
      </form>
    </div>
  </div>


  <!-- Modal de detalhes - UI/UX aprimorado -->
  <div *ngIf="showDetails && selectedUser" class="modal fade show d-block" tabindex="-1" style="background:rgba(0,0,0,0.3)">
    <div class="modal-dialog modal-lg">
      <div class="modal-content rounded-4 shadow-lg">
        <div class="modal-header bg-primary text-white rounded-top-4">
          <h4 class="modal-title d-flex align-items-center">
            <i class="bi bi-person-circle me-2 fs-2 text-warning"></i>
            {{ selectedUser.name }}
          </h4>
          <button type="button" class="btn-close btn-close-white" (click)="closeDetails()"></button>
        </div>
        <div class="modal-body p-4">
          <div class="row g-3">
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-envelope-fill text-info fs-4 me-2"></i>
                <span class="fw-bold">Email:</span>
                <span class="ms-2">{{ selectedUser.email }}</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-telephone-fill text-success fs-4 me-2"></i>
                <span class="fw-bold">Telefone:</span>
                <span class="ms-2">{{ selectedUser.phone }}</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-person-badge-fill text-primary fs-4 me-2"></i>
                <span class="fw-bold">Função:</span>
                <span class="ms-2">{{ selectedUser.role }}</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-geo-alt-fill text-danger fs-4 me-2"></i>
                <span class="fw-bold">Endereço:</span>
                <span class="ms-2">{{ selectedUser.address }}</span>
              </div>
            </div>
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-building text-secondary fs-4 me-2"></i>
                <span class="fw-bold">Empresa:</span>
                <span class="ms-2">{{ selectedUser.tenant?.companyName || 'N/A' }}</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-credit-card-2-front-fill text-warning fs-4 me-2"></i>
                <span class="fw-bold">Código:</span>
                <span class="ms-2">{{ selectedUser.tenant?.code || 'N/A' }}</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-cash-coin text-success fs-4 me-2"></i>
                <span class="fw-bold">Pagamento:</span>
                <span class="ms-2">{{ selectedUser.tenant?.paymentStatus || 'N/A' }} - {{ selectedUser.tenant?.paymentMethod || 'N/A' }}</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-calendar-event-fill text-info fs-4 me-2"></i>
                <span class="fw-bold">Frequência:</span>
                <span class="ms-2">{{ selectedUser.tenant?.paymentFrequency || 'N/A' }}</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-clock-history text-danger fs-4 me-2"></i>
                <span class="fw-bold">Vencimento:</span>
                <span class="ms-2">{{ selectedUser.tenant?.paymentDueDate || 'N/A' }}</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-check-circle-fill fs-4 me-2" [ngClass]="selectedUser.isActive ? 'text-success' : 'text-danger'"></i>
                <span class="fw-bold">Status:</span>
                <span class="ms-2" [class]="selectedUser.isActive ? 'text-success' : 'text-danger'">{{ selectedUser.isActive ? 'Ativo' : 'Inativo' }}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer bg-light rounded-bottom-4">
          <button type="button" class="btn btn-secondary" (click)="closeDetails()">
            <i class="bi bi-x-circle"></i> Fechar
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col" (click)="sortBy('name')" style="cursor: pointer">
            Nome
            <i *ngIf="sortColumn === 'name'" class="bi" [ngClass]="{'bi-arrow-up': sortDirection==='asc', 'bi-arrow-down': sortDirection==='desc'}"></i>
          </th>
          <th scope="col" (click)="sortBy('email')" style="cursor: pointer">
            Email
            <i *ngIf="sortColumn === 'email'" class="bi" [ngClass]="{'bi-arrow-up': sortDirection==='asc', 'bi-arrow-down': sortDirection==='desc'}"></i>
          </th>
          <th scope="col" (click)="sortBy('phone')" style="cursor: pointer">
            Telefone
            <i *ngIf="sortColumn === 'phone'" class="bi" [ngClass]="{'bi-arrow-up': sortDirection==='asc', 'bi-arrow-down': sortDirection==='desc'}"></i>
          </th>
          <th scope="col" (click)="sortBy('status')" style="cursor: pointer">
            Status
            <i *ngIf="sortColumn === 'status'" class="bi" [ngClass]="{'bi-arrow-up': sortDirection==='asc', 'bi-arrow-down': sortDirection==='desc'}"></i>
          </th>
          <!-- <th scope="col" (click)="sortBy('createdAt')" style="cursor: pointer">
            Criado Em
            <i *ngIf="sortColumn === 'createdAt'" class="bi" [ngClass]="{'bi-arrow-up': sortDirection==='asc', 'bi-arrow-down': sortDirection==='desc'}"></i>
          </th> -->
          <th scope="col">
            Ações
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users(); let i = index">
          <th scope="row">{{ i + 1 }}</th>
          <td>{{ user.name }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.phone }}</td>
          <td>
            <span *ngIf="user.isActive" class="text-success">
              <i class="bi bi-check-circle"></i> Sim
            </span>
            <span *ngIf="!user.isActive" class="text-danger">
              <i class="bi bi-x-circle"></i> Não
            </span>
          </td>
          <!-- <td>{{ user.createdAt | date: 'short' }}</td> -->
          <td>
            <button class="btn btn-primary btn-sm me-1" (click)="viewUser(user.id)">
              <i class="bi bi-eye"></i>
            </button>
            <ng-container *ngIf="user.id !== loggedUserId">
              <button class="btn btn-warning btn-sm me-1" (click)="editUser(user.id)">
                <i class="bi bi-pencil-square"></i>
              </button>
              <button class="btn btn-danger btn-sm" (click)="deleteUser(user.id)">
                <i class="bi bi-trash"></i>
              </button>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
