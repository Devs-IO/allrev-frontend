<div class="container my-4">
  <div class="form-header">
    <h1 class="form-title">
      <i class="fas fa-user-plus"></i>
      Cadastrar Novo Usuário
    </h1>
    <p class="form-subtitle">Preencha os dados para criar um novo usuário</p>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle"></i>
    {{ error }}
  </div>

  <!-- Success Alert -->
  <div *ngIf="success" class="alert alert-success" role="alert">
    <i class="fas fa-check-circle"></i>
    Usuário criado com sucesso!
  </div>

  <!-- Form -->
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
    <div class="form-grid">

      <!-- Nome -->
      <div class="form-group">
        <label for="name" class="form-label">
          <i class="fas fa-user"></i>
          Nome Completo *
        </label>
        <input
          id="name"
          type="text"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('name')"
          formControlName="name"
          placeholder="Digite o nome completo"
          maxlength="100"
        />
        <div *ngIf="getFieldError('name')" class="invalid-feedback">
          {{ getFieldError('name') }}
        </div>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email" class="form-label">
          <i class="fas fa-envelope"></i>
          Email *
        </label>
        <input
          id="email"
          type="email"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('email')"
          formControlName="email"
          placeholder="usuario@exemplo.com"
          maxlength="100"
        />
        <div *ngIf="getFieldError('email')" class="invalid-feedback">
          {{ getFieldError('email') }}
        </div>
      </div>

      <!-- Telefone -->
      <div class="form-group">
        <label for="phone" class="form-label">
          <i class="fas fa-phone"></i>
          Telefone *
        </label>
        <input
          id="phone"
          type="text"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('phone')"
          formControlName="phone"
          placeholder="(11) 99999-9999"
          mask="(00) 00000-0000"
        />
        <div *ngIf="getFieldError('phone')" class="invalid-feedback">
          {{ getFieldError('phone') }}
        </div>
      </div>

      <!-- Função/Role -->
      <div class="form-group">
        <label for="role" class="form-label">
          <i class="fas fa-user-tag"></i>
          Função *
        </label>
        <select
          id="role"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('role')"
          formControlName="role"
        >
          <option value="" disabled>Selecione a função</option>
          <option *ngFor="let option of getAvailableRoles()" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
        <div *ngIf="getFieldError('role')" class="invalid-feedback">
          {{ getFieldError('role') }}
        </div>
      </div>

      <!-- Senha -->
      <div class="form-group">
        <label for="password" class="form-label">
          <i class="fas fa-lock"></i>
          Senha *
        </label>
        <input
          id="password"
          type="password"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('password')"
          formControlName="password"
          placeholder="Mínimo 8 caracteres"
          maxlength="50"
        />
        <div *ngIf="getFieldError('password')" class="invalid-feedback">
          {{ getFieldError('password') }}
        </div>
      </div>

      <!-- Empresa (Tenant) -->
      <div class="form-group">
        <label for="tenantId" class="form-label">
          <i class="fas fa-building"></i>
          Empresa *
        </label>
        <div class="tenant-input-group" *ngIf="isAdmin; else tenantReadonly">
          <select
            id="tenantId"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('tenantId')"
            formControlName="tenantId"
          >
            <option value="" disabled>Selecione a empresa</option>
            <option *ngFor="let tenant of tenants" [value]="tenant.id">
              {{ tenant.companyName }}
            </option>
          </select>
          <button
            type="button"
            class="btn btn-outline-primary btn-sm ms-2"
            (click)="openTenantForm()"
            title="Nova Empresa"
          >
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <ng-template #tenantReadonly>
          <input
            id="tenantId"
            type="text"
            class="form-control"
            [value]="tenantName"
            readonly
          />
          <small class="form-text text-muted">
            Empresa atribuída automaticamente baseada no seu perfil
          </small>
        </ng-template>
        <div *ngIf="getFieldError('tenantId')" class="invalid-feedback">
          {{ getFieldError('tenantId') }}
        </div>
      </div>

      <!-- Foto -->
      <div class="form-group">
        <label for="photo" class="form-label">
          <i class="fas fa-image"></i>
          URL da Foto de Perfil
        </label>
        <input
          id="photo"
          type="url"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('photo')"
          formControlName="photo"
          placeholder="https://exemplo.com/foto.jpg"
        />
        <div *ngIf="getFieldError('photo')" class="invalid-feedback">
          {{ getFieldError('photo') }}
        </div>
      </div>

      <!-- Status Ativo -->
      <div class="form-group toggle-group">
        <label class="form-label">
          <i class="fas fa-toggle-on"></i>
          Status do Usuário
        </label>
        <div class="toggle-container">
          <label class="toggle-switch">
            <input
              type="checkbox"
              formControlName="isActive"
            />
            <span class="toggle-slider"></span>
          </label>
          <span class="toggle-label">
            {{ userForm.get('isActive')?.value ? 'Ativo' : 'Inativo' }}
          </span>
        </div>
      </div>

    </div>

    <!-- Endereço (full width) -->
    <div class="form-group full-width">
      <label for="address" class="form-label">
        <i class="fas fa-map-marker-alt"></i>
        Endereço Completo *
      </label>
      <input
        id="address"
        type="text"
        class="form-control"
        [class.is-invalid]="isFieldInvalid('address')"
        formControlName="address"
        placeholder="Rua, Número, Bairro, Cidade - Estado, CEP"
        maxlength="200"
      />
      <div *ngIf="getFieldError('address')" class="invalid-feedback">
        {{ getFieldError('address') }}
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        routerLink="/users"
        [disabled]="loading"
      >
        <i class="fas fa-times"></i>
        Cancelar
      </button>

      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!userForm.valid || loading"
      >
        <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
        <i class="fas fa-user-plus" *ngIf="!loading"></i>
        {{ loading ? 'Salvando...' : 'Cadastrar Usuário' }}
      </button>
    </div>
  </form>
</div>
