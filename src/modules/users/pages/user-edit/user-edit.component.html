
<div class="container my-4">
  <div class="form-header">
    <h2 class="form-title">
      <i class="fas fa-user-edit"></i>
      Editar Usuário
    </h2>
    <p class="form-subtitle">Atualize os dados do usuário</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-2">Carregando dados do usuário...</p>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ error }}
  </div>

  <!-- Form -->
  <div *ngIf="!loading && !error && user">
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
      <div class="form-grid">

        <!-- Nome -->
        <div class="form-group">
          <label for="name" class="form-label">
            <i class="fas fa-user"></i>
            Nome Completo *
          </label>
          <input
            id="name"
            type="text"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('name')"
            formControlName="name"
            placeholder="Ex: João da Silva"
            maxlength="100"
          />
          <div *ngIf="getFieldError('name')" class="invalid-feedback">
            {{ getFieldError('name') }}
          </div>
        </div>

        <!-- Email (readonly) -->
        <div class="form-group">
          <label for="email" class="form-label">
            <i class="fas fa-envelope"></i>
            Email
          </label>
          <input
            id="email"
            type="email"
            class="form-control"
            formControlName="email"
            readonly
            style="background-color: #f8f9fa; cursor: not-allowed;"
          />
          <small class="form-text text-muted">O email não pode ser alterado</small>
        </div>

        <!-- Telefone -->
        <div class="form-group">
          <label for="phone" class="form-label">
            <i class="fas fa-phone"></i>
            Telefone *
          </label>
          <input
            id="phone"
            type="text"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('phone')"
            formControlName="phone"
            placeholder="(11) 99999-9999"
          />
          <div *ngIf="getFieldError('phone')" class="invalid-feedback">
            {{ getFieldError('phone') }}
          </div>
        </div>

        <!-- Função -->
        <div class="form-group">
          <label for="role" class="form-label">
            <i class="fas fa-user-tag"></i>
            Função *
          </label>
          <select
            id="role"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('role')"
            formControlName="role"
          >
            <option value="" disabled>Selecione a função</option>
            <option *ngFor="let option of roleOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <div *ngIf="getFieldError('role')" class="invalid-feedback">
            {{ getFieldError('role') }}
          </div>
        </div>

        <!-- Tenant (readonly) -->
        <div class="form-group">
          <label for="tenant" class="form-label">
            <i class="fas fa-building"></i>
            Empresa
          </label>
          <input
            id="tenant"
            type="text"
            class="form-control"
            [value]="tenantName"
            readonly
            style="background-color: #f8f9fa; cursor: not-allowed;"
          />
          <small class="form-text text-muted">A empresa não pode ser alterada</small>
        </div>

        <!-- Status Ativo -->
        <div class="form-group toggle-group">
          <label class="form-label">
            <i class="fas fa-toggle-on"></i>
            Status do Usuário
          </label>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" formControlName="isActive">
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label">
              {{ userForm.get('isActive')?.value ? 'Ativo' : 'Inativo' }}
            </span>
          </div>
        </div>

      </div>

      <!-- Endereço (full width) -->
      <div class="form-group full-width">
        <label for="address" class="form-label">
          <i class="fas fa-map-marker-alt"></i>
          Endereço Completo *
        </label>
        <input
          id="address"
          type="text"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('address')"
          formControlName="address"
          placeholder="Rua, Número, Bairro, Cidade - Estado, CEP"
          maxlength="200"
        />
        <div *ngIf="getFieldError('address')" class="invalid-feedback">
          {{ getFieldError('address') }}
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="cancel()"
          [disabled]="saving"
        >
          <i class="fas fa-times"></i>
          Cancelar
        </button>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!userForm.valid || saving"
        >
          <i class="fas fa-spinner fa-spin" *ngIf="saving"></i>
          <i class="fas fa-save" *ngIf="!saving"></i>
          {{ saving ? 'Salvando...' : 'Salvar Alterações' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de Confirmação de Edição -->
<div class="modal fade" id="confirmEditModal" tabindex="-1" aria-labelledby="confirmEditModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmEditModalLabel">
          <i class="fas fa-question-circle text-warning me-2"></i>
          Confirmar Edição
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Tem certeza de que deseja salvar as alterações do usuário <strong>{{ user?.name }}</strong>?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>
          Cancelar
        </button>
        <button type="button" class="btn btn-primary" (click)="confirmSave()">
          <i class="fas fa-check me-1"></i>
          Confirmar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Sucesso -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="successModalLabel">
          <i class="fas fa-check-circle me-2"></i>
          Sucesso
        </h5>
      </div>
      <div class="modal-body">
        <p class="mb-0">Usuário editado com sucesso!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="redirectToList()">
          <i class="fas fa-list me-1"></i>
          Ir para Listagem
        </button>
      </div>
    </div>
  </div>
</div>
