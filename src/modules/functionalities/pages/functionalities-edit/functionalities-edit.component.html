<div class="container my-4">
  <h2 class="text-primary">
    <i class="fas fa-edit"></i> Editar Funcionalidade
  </h2>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle"></i> {{ error }}
  </div>

  <!-- Success Alert -->
  <div *ngIf="success" class="alert alert-success">
    <i class="fas fa-check-circle"></i> {{ success }}
  </div>

  <!-- Loading State -->
  <div *ngIf="isSubmitting" class="text-center my-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-2">Salvando alterações...</p>
  </div>

  <!-- Form -->
  <form *ngIf="!isSubmitting" [formGroup]="form" (ngSubmit)="submit()">

    <!-- Informações Básicas -->
    <div class="card mb-4">
      <div class="card-header">
        <h5><i class="fas fa-info-circle"></i> Informações Básicas</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- Nome -->
          <div class="col-md-6 mb-3">
            <label for="name" class="form-label">
              <i class="fas fa-tag"></i> Nome *
            </label>
            <input
              id="name"
              class="form-control"
              formControlName="name"
              [class.is-invalid]="form.get('name')?.invalid && form.get('name')?.touched"
              placeholder="Ex: Desenvolvimento Web"
              required
            />
            <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="invalid-feedback">
              <div *ngIf="form.get('name')?.errors?.['required']">Nome é obrigatório</div>
              <div *ngIf="form.get('name')?.errors?.['minlength']">Nome deve ter pelo menos 3 caracteres</div>
              <div *ngIf="form.get('name')?.errors?.['maxlength']">Nome deve ter no máximo 100 caracteres</div>
            </div>
          </div>

          <!-- Status Ativo -->
          <div class="col-md-6 mb-3">
            <label class="form-label">
              <i class="fas fa-toggle-on"></i> Status da Funcionalidade
            </label>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                formControlName="isActive"
                id="isActive"
              />
              <label class="form-check-label" for="isActive">
                {{ form.get('isActive')?.value ? 'Ativa' : 'Inativa' }}
              </label>
            </div>
          </div>
        </div>

        <!-- Descrição (full width) -->
        <div class="mb-3">
          <label for="description" class="form-label">
            <i class="fas fa-align-left"></i> Descrição
          </label>
          <textarea
            id="description"
            class="form-control"
            formControlName="description"
            rows="3"
            placeholder="Descreva a funcionalidade (opcional)"
          ></textarea>
        </div>
      </div>
    </div>

    <!-- Configurações de Preço -->
    <div class="card mb-4">
      <div class="card-header">
        <h5><i class="fas fa-dollar-sign"></i> Configurações de Preço</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- Preço Mínimo -->
          <div class="col-md-6 mb-3">
            <label for="minimumPrice" class="form-label">
              <i class="fas fa-money-bill-wave"></i> Preço Mínimo *
            </label>
            <input
              id="minimumPrice"
              type="number"
              step="0.01"
              min="0.01"
              class="form-control"
              formControlName="minimumPrice"
              [class.is-invalid]="form.get('minimumPrice')?.invalid && form.get('minimumPrice')?.touched"
              placeholder="0.00"
              required
            />
            <div *ngIf="form.get('minimumPrice')?.invalid && form.get('minimumPrice')?.touched" class="invalid-feedback">
              <div *ngIf="form.get('minimumPrice')?.errors?.['required']">Preço mínimo é obrigatório</div>
              <div *ngIf="form.get('minimumPrice')?.errors?.['min']">Preço mínimo deve ser maior que 0</div>
            </div>
          </div>

          <!-- Preço Padrão do Assistente -->
          <div class="col-md-6 mb-3">
            <label for="defaultAssistantPrice" class="form-label">
              <i class="fas fa-user-tie"></i> Preço Padrão do Assistente
            </label>
            <input
              id="defaultAssistantPrice"
              type="number"
              step="0.01"
              min="0"
              class="form-control"
              formControlName="defaultAssistantPrice"
              placeholder="0.00 (opcional)"
            />
            <small class="form-text text-muted">
              Valor sugerido para pagamento aos assistentes
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="d-flex justify-content-end gap-2">
      <button
        type="button"
        class="btn btn-secondary"
        routerLink="/functionalities"
        [disabled]="isSubmitting"
      >
        <i class="fas fa-times"></i> Cancelar
      </button>

      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!form.valid || isSubmitting || !hasFormChanged()"
      >
        <i class="fas fa-spinner fa-spin" *ngIf="isSubmitting"></i>
        <i class="fas fa-save" *ngIf="!isSubmitting"></i>
        {{ isSubmitting ? 'Salvando...' : 'Salvar Alterações' }}
      </button>
    </div>
  </form>
</div>
