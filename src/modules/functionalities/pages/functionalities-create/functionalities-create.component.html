
<div class="container my-4">
  <h2 class="text-primary"><i class="bi bi-gear-fill"></i> Nova Funcionalidade</h2>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>
  
  <form [formGroup]="form" (ngSubmit)="submit()">
    <div class="mb-3">
      <label><i class="bi bi-tag-fill"></i> Nome *</label>
      <input 
        class="form-control" 
        formControlName="name" 
        [class.is-invalid]="form.get('name')?.invalid && form.get('name')?.touched"
        required 
      />
      <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="invalid-feedback">
        <div *ngIf="form.get('name')?.errors?.['required']">Nome é obrigatório</div>
        <div *ngIf="form.get('name')?.errors?.['minlength']">Nome deve ter pelo menos 3 caracteres</div>
        <div *ngIf="form.get('name')?.errors?.['maxlength']">Nome deve ter no máximo 100 caracteres</div>
      </div>
    </div>

    <div class="mb-3">
      <label><i class="bi bi-text-paragraph"></i> Descrição</label>
      <textarea 
        class="form-control" 
        formControlName="description" 
        rows="3"
        placeholder="Descreva a funcionalidade (opcional)"
      ></textarea>
    </div>

    <div class="mb-3">
      <label><i class="bi bi-currency-dollar"></i> Preço Mínimo *</label>
      <input 
        type="number" 
        step="0.01" 
        min="0.01"
        class="form-control" 
        formControlName="minimumPrice"
        [class.is-invalid]="form.get('minimumPrice')?.invalid && form.get('minimumPrice')?.touched"
        required 
      />
      <div *ngIf="form.get('minimumPrice')?.invalid && form.get('minimumPrice')?.touched" class="invalid-feedback">
        <div *ngIf="form.get('minimumPrice')?.errors?.['required']">Preço mínimo é obrigatório</div>
        <div *ngIf="form.get('minimumPrice')?.errors?.['min']">Preço mínimo deve ser maior que 0</div>
      </div>
    </div>

    <div class="mb-3">
      <label><i class="bi bi-cash-coin"></i> Preço Padrão do Assistente</label>
      <input 
        type="number" 
        step="0.01" 
        min="0"
        class="form-control" 
        formControlName="defaultAssistantPrice"
        [class.is-invalid]="form.get('defaultAssistantPrice')?.invalid && form.get('defaultAssistantPrice')?.touched"
        placeholder="Valor padrão para assistentes (opcional)"
      />
      <div *ngIf="form.get('defaultAssistantPrice')?.invalid && form.get('defaultAssistantPrice')?.touched" class="invalid-feedback">
        <div *ngIf="form.get('defaultAssistantPrice')?.errors?.['max']">Preço do assistente não pode ser maior que o preço mínimo</div>
      </div>
    </div>

    <div class="mb-3">
      <label><i class="bi bi-person-badge"></i> Responsável *</label>
      <select 
        class="form-control" 
        formControlName="responsibleUserId"
        [class.is-invalid]="form.get('responsibleUserId')?.invalid && form.get('responsibleUserId')?.touched"
        required
      >
        <option value="" disabled>Selecione o responsável</option>
        <option *ngFor="let user of responsibleUsers" [value]="user.id">{{ user.name }}</option>
      </select>
      <div *ngIf="form.get('responsibleUserId')?.invalid && form.get('responsibleUserId')?.touched" class="invalid-feedback">
        <div *ngIf="form.get('responsibleUserId')?.errors?.['required']">Responsável é obrigatório</div>
      </div>
    </div>

    <div class="mb-3">
      <label><i class="bi bi-toggle-on"></i> Status</label>
      <div class="form-check form-switch">
        <input 
          class="form-check-input" 
          type="checkbox" 
          formControlName="status" 
          id="statusToggle"
        >
        <label class="form-check-label" for="statusToggle">
          {{ form.get('status')?.value ? 'Ativo' : 'Inativo' }}
        </label>
      </div>
    </div>

    <div class="d-flex gap-2">
      <button 
        type="submit" 
        class="btn btn-success" 
        [disabled]="form.invalid || loading"
      >
        <i class="bi bi-check-circle"></i> 
        <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
        Criar
      </button>
      <a routerLink="/functionalities" class="btn btn-secondary">
        <i class="bi bi-x-circle"></i> Cancelar
      </a>
    </div>
  </form>
</div>
