

<div class="container my-4">
  <h2 class="text-primary">
    <i class="fas fa-cube"></i> Cadastrar Nova Funcionalidade
  </h2>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle"></i> {{ error }}
  </div>

  <!-- Success Alert -->
  <div *ngIf="success" class="alert alert-success">
    <i class="fas fa-check-circle"></i> {{ success }}
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center my-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-2">Salvando dados...</p>
  </div>

  <!-- Form -->
  <form *ngIf="!loading" [formGroup]="form" (ngSubmit)="submit()" class="user-form">
    <!-- Dados da Funcionalidade -->
    <div class="card mb-4">
      <div class="card-header">
        <h5><i class="fas fa-cube"></i> Dados da Funcionalidade</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- Nome -->
          <div class="col-md-6 mb-3">
            <label for="name" class="form-label">
              <i class="fas fa-tag"></i> Nome *
            </label>
            <input
              id="name"
              type="text"
              class="form-control"
              formControlName="name"
              placeholder="Ex: Desenvolvimento Web"
              maxlength="100"
              [class.is-invalid]="form.get('name')?.invalid && form.get('name')?.touched"
              required
            />
            <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="invalid-feedback">
              <div *ngIf="form.get('name')?.errors?.['required']">Nome é obrigatório</div>
              <div *ngIf="form.get('name')?.errors?.['minlength']">Nome deve ter pelo menos 3 caracteres</div>
              <div *ngIf="form.get('name')?.errors?.['maxlength']">Nome deve ter no máximo 100 caracteres</div>
            </div>
          </div>

          <!-- Status Ativo -->
          <div class="col-md-6 mb-3">
            <label class="form-label">
              <i class="fas fa-toggle-on"></i> Status da Funcionalidade
            </label>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                formControlName="isActive"
                id="isActive"
              />
              <label class="form-check-label" for="isActive">
                {{ form.get('isActive')?.value ? 'Ativa' : 'Inativa' }}
              </label>
            </div>
          </div>
        </div>

        <!-- Descrição -->
        <div class="mb-3">
          <label for="description" class="form-label">
            <i class="fas fa-align-left"></i> Descrição
          </label>
          <textarea
            id="description"
            class="form-control"
            formControlName="description"
            rows="3"
            placeholder="Descreva a funcionalidade (opcional)"
          ></textarea>
        </div>

        <!-- Usuário Responsável -->
        <div class="mb-3">
          <label for="responsibleUserId" class="form-label">
            <i class="fas fa-user-shield"></i> Usuário Responsável *
          </label>
          <select
            id="responsibleUserId"
            class="form-control"
            formControlName="responsibleUserId"
            [class.is-invalid]="form.get('responsibleUserId')?.invalid && form.get('responsibleUserId')?.touched"
            required
          >
            <option value="">Selecione um usuário responsável</option>
            <option *ngFor="let user of responsibleUsers" [value]="user.id">
              {{ user.name }}
            </option>
          </select>
          <div *ngIf="form.get('responsibleUserId')?.invalid && form.get('responsibleUserId')?.touched" class="invalid-feedback">
            <div *ngIf="form.get('responsibleUserId')?.errors?.['required']">Usuário responsável é obrigatório</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Configurações de Preço -->
    <div class="card mb-4">
      <div class="card-header">
        <h5><i class="fas fa-dollar-sign"></i> Configurações de Preço</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- Preço Mínimo -->
          <div class="col-md-6 mb-3">
            <label for="minimumPrice" class="form-label">
              <i class="fas fa-money-bill-wave"></i> Preço Mínimo *
            </label>
            <input
              id="minimumPrice"
              type="number"
              step="0.01"
              min="0.01"
              class="form-control"
              formControlName="minimumPrice"
              placeholder="0.00"
              [class.is-invalid]="form.get('minimumPrice')?.invalid && form.get('minimumPrice')?.touched"
              required
            />
            <div *ngIf="form.get('minimumPrice')?.invalid && form.get('minimumPrice')?.touched" class="invalid-feedback">
              <div *ngIf="form.get('minimumPrice')?.errors?.['required']">Preço mínimo é obrigatório</div>
              <div *ngIf="form.get('minimumPrice')?.errors?.['min']">Preço mínimo deve ser maior que 0</div>
            </div>
          </div>

          <!-- Preço Padrão do Assistente -->
          <div class="col-md-6 mb-3">
            <label for="defaultAssistantPrice" class="form-label">
              <i class="fas fa-user-tie"></i> Preço Padrão do Assistente
            </label>
            <input
              id="defaultAssistantPrice"
              type="number"
              step="0.01"
              min="0"
              class="form-control"
              formControlName="defaultAssistantPrice"
              placeholder="0.00 (opcional)"
              [class.is-invalid]="form.get('defaultAssistantPrice')?.invalid && form.get('defaultAssistantPrice')?.touched"
            />
            <small class="form-text text-muted">
              Valor sugerido para pagamento aos assistentes
            </small>
            <div *ngIf="form.get('defaultAssistantPrice')?.invalid && form.get('defaultAssistantPrice')?.touched" class="invalid-feedback">
              <div *ngIf="form.get('defaultAssistantPrice')?.errors?.['max']">
                O Preço Padrão do Assistente deve ser menor que o Preço Mínimo.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="d-flex justify-content-end gap-2">
      <button
        type="button"
        class="btn btn-secondary"
        routerLink="/functionalities"
        [disabled]="loading"
      >
        <i class="fas fa-times"></i> Cancelar
      </button>

      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!form.valid || loading"
      >
        <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
        <i class="fas fa-save" *ngIf="!loading"></i>
        {{ loading ? 'Salvando...' : 'Cadastrar Funcionalidade' }}
      </button>
    </div>
  </form>
</div>
