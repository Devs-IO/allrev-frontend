<div class="container my-4">
  <div class="form-header">
    <h2 class="form-title">
      <i class="fas fa-edit"></i>
      Editar Empresa
    </h2>
    <p class="form-subtitle">Atualize os dados da empresa</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-2">Carregando dados da empresa...</p>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ error }}
  </div>

  <!-- Form -->
  <div *ngIf="!loading && !error && tenant">
    <form [formGroup]="tenantForm" (ngSubmit)="onSubmit()" class="tenant-form">
      <div class="form-grid">

        <!-- Código (readonly) -->
        <div class="form-group">
          <label for="code" class="form-label">
            <i class="fas fa-tag"></i>
            Código
          </label>
          <input
            id="code"
            type="text"
            class="form-control"
            formControlName="code"
            readonly
            style="background-color: #f8f9fa; cursor: not-allowed;"
          />
          <small class="form-text text-muted">O código não pode ser alterado</small>
        </div>

        <!-- Nome da Empresa -->
        <div class="form-group">
          <label for="companyName" class="form-label">
            <i class="fas fa-building"></i>
            Nome da Empresa *
          </label>
          <input
            id="companyName"
            type="text"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('companyName')"
            formControlName="companyName"
            placeholder="Ex: ACME Corporation"
            maxlength="100"
          />
          <div *ngIf="getFieldError('companyName')" class="invalid-feedback">
            {{ getFieldError('companyName') }}
          </div>
        </div>

        <!-- Telefone -->
        <div class="form-group">
          <label for="phone" class="form-label">
            <i class="fas fa-phone"></i>
            Telefone *
          </label>
          <input
            id="phone"
            type="text"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('phone')"
            formControlName="phone"
            placeholder="(11) 99999-9999"
          />
          <div *ngIf="getFieldError('phone')" class="invalid-feedback">
            {{ getFieldError('phone') }}
          </div>
        </div>

        <!-- Status de Pagamento -->
        <div class="form-group">
          <label for="paymentStatus" class="form-label">
            <i class="fas fa-credit-card"></i>
            Status de Pagamento *
          </label>
          <select
            id="paymentStatus"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('paymentStatus')"
            formControlName="paymentStatus"
          >
            <option value="" disabled>Selecione o status</option>
            <option *ngFor="let option of paymentStatusOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <div *ngIf="getFieldError('paymentStatus')" class="invalid-feedback">
            {{ getFieldError('paymentStatus') }}
          </div>
        </div>

        <!-- Método de Pagamento -->
        <div class="form-group">
          <label for="paymentMethod" class="form-label">
            <i class="fas fa-money-bill-wave"></i>
            Método de Pagamento *
          </label>
          <select
            id="paymentMethod"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('paymentMethod')"
            formControlName="paymentMethod"
          >
            <option value="" disabled>Selecione o método</option>
            <option *ngFor="let option of paymentMethodOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <div *ngIf="getFieldError('paymentMethod')" class="invalid-feedback">
            {{ getFieldError('paymentMethod') }}
          </div>
        </div>

        <!-- Frequência de Pagamento -->
        <div class="form-group">
          <label for="paymentFrequency" class="form-label">
            <i class="fas fa-calendar-alt"></i>
            Frequência de Pagamento *
          </label>
          <select
            id="paymentFrequency"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('paymentFrequency')"
            formControlName="paymentFrequency"
          >
            <option *ngFor="let option of paymentFrequencyOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <div *ngIf="getFieldError('paymentFrequency')" class="invalid-feedback">
            {{ getFieldError('paymentFrequency') }}
          </div>
        </div>

        <!-- Data de Vencimento -->
        <div class="form-group">
          <label for="paymentDueDate" class="form-label">
            <i class="fas fa-calendar"></i>
            Data de Vencimento *
          </label>
          <input
            id="paymentDueDate"
            type="date"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('paymentDueDate')"
            formControlName="paymentDueDate"
          />
          <div *ngIf="getFieldError('paymentDueDate')" class="invalid-feedback">
            {{ getFieldError('paymentDueDate') }}
          </div>
        </div>

        <!-- Status Ativo -->
        <div class="form-group toggle-group">
          <label class="form-label">
            <i class="fas fa-toggle-on"></i>
            Status da Empresa
          </label>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" formControlName="isActive">
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label">
              {{ tenantForm.get('isActive')?.value ? 'Ativa' : 'Inativa' }}
            </span>
          </div>
        </div>

      </div>

      <!-- Endereço (full width) -->
      <div class="form-group full-width">
        <label for="address" class="form-label">
          <i class="fas fa-map-marker-alt"></i>
          Endereço Completo *
        </label>
        <input
          id="address"
          type="text"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('address')"
          formControlName="address"
          placeholder="Rua, Número, Bairro, Cidade - Estado, CEP"
          maxlength="200"
        />
        <div *ngIf="getFieldError('address')" class="invalid-feedback">
          {{ getFieldError('address') }}
        </div>
      </div>

      <!-- Descrição (full width) -->
      <div class="form-group full-width">
        <label for="description" class="form-label">
          <i class="fas fa-align-left"></i>
          Descrição da Empresa
        </label>
        <textarea
          id="description"
          class="form-control"
          [class.is-invalid]="isFieldInvalid('description')"
          formControlName="description"
          placeholder="Descreva brevemente a empresa, seus serviços e atividades..."
          rows="4"
          maxlength="500"
        ></textarea>
        <small class="form-text text-muted">
          {{ tenantForm.get('description')?.value?.length || 0 }}/500 caracteres
        </small>
        <div *ngIf="getFieldError('description')" class="invalid-feedback">
          {{ getFieldError('description') }}
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="cancel()"
          [disabled]="saving"
        >
          <i class="fas fa-times"></i>
          Cancelar
        </button>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!tenantForm.valid || saving"
        >
          <i class="fas fa-spinner fa-spin" *ngIf="saving"></i>
          <i class="fas fa-save" *ngIf="!saving"></i>
          {{ saving ? 'Salvando...' : 'Salvar Alterações' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de Confirmação de Edição -->
<div class="modal fade" id="confirmEditModal" tabindex="-1" aria-labelledby="confirmEditModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmEditModalLabel">
          <i class="fas fa-question-circle text-warning me-2"></i>
          Confirmar Edição
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Tem certeza de que deseja salvar as alterações da empresa <strong>{{ tenant?.companyName }}</strong>?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>
          Cancelar
        </button>
        <button type="button" class="btn btn-primary" (click)="confirmSave()">
          <i class="fas fa-check me-1"></i>
          Confirmar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Sucesso -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="successModalLabel">
          <i class="fas fa-check-circle me-2"></i>
          Sucesso
        </h5>
      </div>
      <div class="modal-body">
        <p class="mb-0">Empresa editada com sucesso!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="redirectToList()">
          <i class="fas fa-list me-1"></i>
          Ir para Listagem
        </button>
      </div>
    </div>
  </div>
</div>
