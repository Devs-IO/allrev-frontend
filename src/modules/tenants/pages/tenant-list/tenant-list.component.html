<div class="container my-4">
  <h1 class="mb-4 text-primary">Empresas</h1>

  <!-- Modal de Confirmação - Editar -->
  <div *ngIf="showEditModal" class="modal fade show d-block" tabindex="-1" style="background:rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-3 shadow-lg">
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title">
            <i class="fas fa-edit me-2"></i>
            Confirmar Edição
          </h5>
          <button type="button" class="btn-close" (click)="closeModals()"></button>
        </div>
        <div class="modal-body text-center py-4">
          <i class="fas fa-edit text-warning fa-3x mb-3"></i>
          <h6 class="mb-3">Tem certeza que deseja editar esta empresa?</h6>
          <p class="text-muted mb-0" *ngIf="selectedTenant">
            <strong>{{ selectedTenant.companyName }}</strong><br>
            <small>Código: {{ selectedTenant.code }}</small>
          </p>
        </div>
        <div class="modal-footer border-0 justify-content-center">
          <button type="button" class="btn btn-outline-secondary px-4" (click)="closeModals()">
            <i class="fas fa-times me-1"></i>
            Cancelar
          </button>
          <button type="button" class="btn btn-warning px-4" (click)="confirmEdit()">
            <i class="fas fa-edit me-1"></i>
            Sim, Editar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmação - Excluir -->
  <div *ngIf="showDeleteModal" class="modal fade show d-block" tabindex="-1" style="background:rgba(0,0,0,0.5)">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-3 shadow-lg">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">
            <i class="fas fa-trash me-2"></i>
            Confirmar Exclusão
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeModals()"></button>
        </div>
        <div class="modal-body text-center py-4">
          <i class="fas fa-exclamation-triangle text-danger fa-3x mb-3"></i>
          <h6 class="mb-3">Tem certeza que deseja excluir esta empresa?</h6>
          <div class="alert alert-warning" role="alert">
            <i class="fas fa-warning me-2"></i>
            <strong>Atenção:</strong> Esta ação não pode ser desfeita!
          </div>
          <p class="text-muted mb-0" *ngIf="selectedTenant">
            <strong>{{ selectedTenant.companyName }}</strong><br>
            <small>Código: {{ selectedTenant.code }}</small>
          </p>
        </div>
        <div class="modal-footer border-0 justify-content-center">
          <button type="button" class="btn btn-outline-secondary px-4" (click)="closeModals()">
            <i class="fas fa-times me-1"></i>
            Cancelar
          </button>
          <button type="button" class="btn btn-danger px-4" (click)="confirmDelete()">
            <i class="fas fa-trash me-1"></i>
            Sim, Excluir
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
    <p class="mt-2">Carregando empresas...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    <i class="fas fa-exclamation-triangle me-2"></i>
    {{ error }}
  </div>

  <!-- Tabela -->
  <div *ngIf="!loading && !error" class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th scope="col">#</th>
              <th scope="col" (click)="sortBy('code')" style="cursor: pointer">
                Código
                <i *ngIf="sortColumn === 'code'" class="fas" [ngClass]="{'fa-arrow-up': sortDirection==='asc', 'fa-arrow-down': sortDirection==='desc'}"></i>
              </th>
              <th scope="col" (click)="sortBy('companyName')" style="cursor: pointer">
                Nome da Empresa
                <i *ngIf="sortColumn === 'companyName'" class="fas" [ngClass]="{'fa-arrow-up': sortDirection==='asc', 'fa-arrow-down': sortDirection==='desc'}"></i>
              </th>
              <th scope="col" (click)="sortBy('address')" style="cursor: pointer">
                Endereço
                <i *ngIf="sortColumn === 'address'" class="fas" [ngClass]="{'fa-arrow-up': sortDirection==='asc', 'fa-arrow-down': sortDirection==='desc'}"></i>
              </th>
              <th scope="col" (click)="sortBy('paymentStatus')" style="cursor: pointer">
                Status Pagamento
                <i *ngIf="sortColumn === 'paymentStatus'" class="fas" [ngClass]="{'fa-arrow-up': sortDirection==='asc', 'fa-arrow-down': sortDirection==='desc'}"></i>
              </th>
              <th scope="col" (click)="sortBy('isActive')" style="cursor: pointer">
                Status
                <i *ngIf="sortColumn === 'isActive'" class="fas" [ngClass]="{'fa-arrow-up': sortDirection==='asc', 'fa-arrow-down': sortDirection==='desc'}"></i>
              </th>
              <th scope="col">Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tenant of tenants(); let i = index">
              <th scope="row">{{ i + 1 }}</th>
              <td>
                <span class="badge bg-secondary">{{ tenant.code }}</span>
              </td>
              <td>
                <strong>{{ tenant.companyName }}</strong>
              </td>
              <td>{{ tenant.address }}</td>
              <td>
                <span class="badge" [ngClass]="{
                  'bg-success': tenant.paymentStatus === PaymentStatus.PAID,
                  'bg-warning': tenant.paymentStatus === PaymentStatus.PENDING,
                  'bg-danger': tenant.paymentStatus === PaymentStatus.OVERDUE,
                  'bg-secondary': tenant.paymentStatus === PaymentStatus.CANCELLED,
                  'bg-info': tenant.paymentStatus === PaymentStatus.UNPAID
                }">
                  {{ paymentStatusLabels[tenant.paymentStatus] }}
                </span>
              </td>
              <td>
                <span *ngIf="tenant.isActive" class="text-success">
                  <i class="fas fa-check-circle"></i> Ativo
                </span>
                <span *ngIf="!tenant.isActive" class="text-danger">
                  <i class="fas fa-times-circle"></i> Inativo
                </span>
              </td>
              <td>
                <div class="btn-group" role="group">
                  <button
                    class="btn btn-outline-primary btn-sm action-btn"
                    (click)="viewTenant(tenant.id)"
                    title="Visualizar">
                    <i class="fas fa-eye"></i>
                  </button>
                  <button
                    class="btn btn-outline-warning btn-sm action-btn"
                    (click)="editTenant(tenant.id)"
                    title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    class="btn btn-outline-danger btn-sm action-btn"
                    (click)="deleteTenant(tenant.id)"
                    title="Excluir">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && !error && tenants().length === 0" class="text-center py-5">
    <i class="fas fa-building fa-3x text-muted mb-3"></i>
    <h5 class="text-muted">Nenhuma empresa cadastrada</h5>
    <p class="text-muted">Clique no menu lateral para cadastrar uma nova empresa.</p>
  </div>
</div>
